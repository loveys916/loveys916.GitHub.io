(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{612:function(t,o,a){"use strict";a.r(o);var v=a(3),r=Object(v.a)({},(function(){var t=this,o=t.$createElement,a=t._self._c||o;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"mp4文件的box排列顺序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mp4文件的box排列顺序"}},[t._v("#")]),t._v(" MP4文件的box排列顺序")]),t._v(" "),a("p",[t._v("MP4文件中的所有数据都装在box中 (iso-14496-12/14)")]),t._v(" "),a("p",[t._v("(QuickTime中为atom)即mp4是由若干个box组成的")]),t._v(" "),a("ol",[a("li",[t._v("ftyp box，在文件的开始位置，描述的文件的版本、兼容协议等；")]),t._v(" "),a("li",[t._v("moov box，这个box中不包含具体媒体数据，但包含本文件中所有媒体数据的宏观描述信息，moov box下有mvhd和trak box。")])]),t._v(" "),a("blockquote",[a("p",[t._v("mvhd中记录了创建时间、修改时间、时间度量标尺、可播放时长等信息。\ntrak中的一系列子box描述了每个媒体轨道的具体信息。")])]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("moof box，这个box是视频分片的描述信息。并不是MP4文件必须的部分，但在我们常见的可在线播放的MP4格式文件中（例如Silverlight Smooth Streaming中的ismv文件）确是重中之重。")]),t._v(" "),a("li",[t._v("mdat box，实际媒体数据。我们最终解码播放的数据都在这里面。")]),t._v(" "),a("li",[t._v("mfra box，一般在文件末尾，媒体的索引文件，可通过查询直接定位所需时间点的媒体数据。")])]),t._v(" "),a("h2",{attrs:{id:"mp4文件的生成与解析-播放"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mp4文件的生成与解析-播放"}},[t._v("#")]),t._v(" MP4文件的生成与解析，播放")]),t._v(" "),a("h4",{attrs:{id:"两个重要的box-moov-and-mdat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#两个重要的box-moov-and-mdat"}},[t._v("#")]),t._v(" 两个重要的box：moov and mdat")]),t._v(" "),a("ol",[a("li",[t._v("生成：先写入mdat后写入moov，因此绝大多数工具都会把moov数据放到mdat后边，比如android的mp4writer，ffmpeg等工具")]),t._v(" "),a("li",[t._v("解析：解析播放的时候，先读取moov，才能解析mdat")])]),t._v(" "),a("h4",{attrs:{id:"播放影响"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#播放影响"}},[t._v("#")]),t._v(" 播放影响")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("本地播放，没有影响，播放软件可以先seek到末尾，读取moov")])]),t._v(" "),a("li",[a("p",[t._v("在线播放")])])]),t._v(" "),a("p",[t._v("(1). 需要http服务器支持seek\n(2). 服务器不支持seek，是个非常不友好的方案，要先把数据下载完成才能播放(无论下载到哪里，新服务器，本地内存或存储)\n(3). (1)和(2)多多少少会引入延时，尤其(2)，影响秒开")]),t._v(" "),a("h2",{attrs:{id:"结论"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#结论"}},[t._v("#")]),t._v(" 结论")]),t._v(" "),a("p",[t._v("moov box需要放在 "),a("strong",[t._v("ftyp")]),t._v(" 后面，"),a("strong",[t._v("mdat")]),t._v(" 前面，能够提高打开速度")]),t._v(" "),a("p",[t._v("windows查看视频信息软件"),a("a",{attrs:{href:"./mp4info.zip"}},[t._v("mp4 info")])])])}),[],!1,null,null,null);o.default=r.exports}}]);